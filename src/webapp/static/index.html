<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–î–∞—à–±–æ—Ä–¥ ‚Äî Rental Bot</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #000);
      line-height: 1.5;
    }
    h1 { font-size: 1.25rem; margin: 0 0 16px; }
    .status {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-weight: 500;
    }
    .status.active { background: #e8f5e9; color: #2e7d32; }
    .status.paused { background: #fff3e0; color: #e65100; }
    .status.empty { background: #f5f5f5; color: #616161; }
    .filters {
      white-space: pre-wrap;
      font-size: 0.9rem;
      padding: 12px;
      background: var(--tg-theme-secondary-bg-color, #f5f5f5);
      border-radius: 8px;
    }
    .error { color: #c62828; }
  </style>
</head>
<body>
  <h1>–î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h1>
  <div id="content">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</p>
  </div>

  <script>
    (function() {
      const tg = window.Telegram && window.Telegram.WebApp;
      if (tg) {
        tg.ready();
        tg.expand();
      }

      const initData = tg ? tg.initData : '';
      const content = document.getElementById('content');

      if (!initData) {
        content.innerHTML = '<p class="error">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ Telegram.</p>';
        return;
      }

      const url = '/api/dashboard?init_data=' + encodeURIComponent(initData);
      fetch(url)
        .then(function(res) {
          if (res.status === 403) {
            throw new Error('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω');
          }
          if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
          return res.json();
        })
        .then(function(data) {
          let html = '';
          if (data.has_filter) {
            html += '<div class="status ' + (data.is_active ? 'active' : 'paused') + '">';
            html += data.is_active ? 'üü¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω' : 'üî¥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            html += '</div>';
            html += '<div class="filters">' + (data.filter_summary || '').replace(/\n/g, '<br>') + '</div>';
          } else {
            html += '<div class="status empty">–§–∏–ª—å—Ç—Ä—ã –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã</div>';
            html += '<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /search –≤ –±–æ—Ç–µ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.</p>';
          }
          content.innerHTML = html;
        })
        .catch(function(err) {
          content.innerHTML = '<p class="error">' + (err.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö') + '</p>';
        });
    })();
  </script>
</body>
</html>
